<div class="content-wrapper">
  <div class="row">
    <div class="col-md-12 grid-margin">
      <div class="d-flex justify-content-between flex-wrap">
        <div class="d-flex align-items-end flex-wrap">
          <div class="mr-md-3 mr-xl-5">
            <h2>Welcome back,</h2>
            <p class="mb-md-0">Your analytics dashboard template.</p>
          </div>
          <div class="d-flex">
            <i class="mdi mdi-home text-muted hover-cursor"></i>
            <p class="text-muted mb-0 hover-cursor">&nbsp;/&nbsp;Dashboard&nbsp;/&nbsp;</p>
            <p class="text-primary mb-0 hover-cursor">Home</p>
          </div>
        </div>
        <div class="d-flex justify-content-between align-items-end flex-wrap">
          <button type="button" class="btn btn-light bg-white btn-icon mr-3 d-none d-md-block ">
            <i class="mdi mdi-download text-muted"></i>
          </button>
          <button type="button" class="btn btn-light bg-white btn-icon mr-3 mt-2 mt-xl-0">
            <i class="mdi mdi-clock-outline text-muted"></i>
          </button>
          <button type="button" class="btn btn-light bg-white btn-icon mr-3 mt-2 mt-xl-0">
            <i class="mdi mdi-plus text-muted"></i>
          </button>
          <button class="btn btn-primary mt-2 mt-xl-0">Generate report</button>
        </div>
      </div>
    </div>
  </div>
  <!--<div class="row" id="proBanner">
    <div class="col-md-12 grid-margin">
      <div class="card bg-gradient-primary border-0">
        <div class="card-body py-3 px-4 d-flex align-items-center justify-content-between flex-wrap">
          <p class="mb-0 text-white font-weight-medium">Like what you see? Checkout our premium version for more.</p>
          <div class="d-flex">
            <a href="https://github.com/Urbanui/MajesticAdmin-Free-Bootstrap-Admin-Template" target="_blank" class="btn btn-outline-light mr-2">Download free version</a>
            <a href="http://www.urbanui.com/majestic-admin-pro/template/" target="_blank" class="btn btn-outline-light mr-2 bg-gradient-danger border-0">Upgrade to Pro</a>
            <button id="bannerClose" class="btn border-0 p-0">
              <i class="mdi mdi-close text-white"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>-->
  <div class="row">
    <div class="col-md-12 grid-margin stretch-card">
      <div class="card">
        <div class="card-body dashboard-tabs p-0">
          <ul class="nav nav-tabs px-4" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" id="overview-tab" data-toggle="tab" href="#overview" role="tab" aria-controls="overview" aria-selected="true">Overview</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="sales-tab" data-toggle="tab" href="#sales" role="tab" aria-controls="sales" aria-selected="false">Sales</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" id="purchases-tab" data-toggle="tab" href="#purchases" role="tab" aria-controls="purchases" aria-selected="false">Purchases</a>
            </li>
          </ul>
          <div class="tab-content py-0 px-0">
            <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
              <div class="d-flex flex-wrap justify-content-xl-between">
                <div class="d-none d-xl-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-calendar-heart icon-lg mr-3 text-primary"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Start date</small>
                    <div class="dropdown">
                      <a class="btn btn-secondary dropdown-toggle p-0 bg-transparent border-0 text-dark shadow-none font-weight-medium" href="#" role="button" id="dropdownMenuLinkA" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <h5 class="mb-0 d-inline-block">26 Jul 2018</h5>
                      </a>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuLinkA">
                        <a class="dropdown-item" href="#">12 Aug 2018</a>
                        <a class="dropdown-item" href="#">22 Sep 2018</a>
                        <a class="dropdown-item" href="#">21 Oct 2018</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-currency-usd mr-3 icon-lg text-danger"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Revenue</small>
                    <h5 class="mr-2 mb-0">$577545</h5>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-eye mr-3 icon-lg text-success"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Total views</small>
                    <h5 class="mr-2 mb-0">9833550</h5>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-download mr-3 icon-lg text-warning"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Downloads</small>
                    <h5 class="mr-2 mb-0">2233783</h5>
                  </div>
                </div>
                <div class="d-flex py-3 border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-flag mr-3 icon-lg text-danger"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Flagged</small>
                    <h5 class="mr-2 mb-0">3497843</h5>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="sales" role="tabpanel" aria-labelledby="sales-tab">
              <div class="d-flex flex-wrap justify-content-xl-between">
                <div class="d-none d-xl-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-calendar-heart icon-lg mr-3 text-primary"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Start date</small>
                    <div class="dropdown">
                      <a class="btn btn-secondary dropdown-toggle p-0 bg-transparent border-0 text-dark shadow-none font-weight-medium" href="#" role="button" id="dropdownMenuLinkA" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <h5 class="mb-0 d-inline-block">26 Jul 2018</h5>
                      </a>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuLinkA">
                        <a class="dropdown-item" href="#">12 Aug 2018</a>
                        <a class="dropdown-item" href="#">22 Sep 2018</a>
                        <a class="dropdown-item" href="#">21 Oct 2018</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-download mr-3 icon-lg text-warning"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Downloads</small>
                    <h5 class="mr-2 mb-0">2233783</h5>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-eye mr-3 icon-lg text-success"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Total views</small>
                    <h5 class="mr-2 mb-0">9833550</h5>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-currency-usd mr-3 icon-lg text-danger"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Revenue</small>
                    <h5 class="mr-2 mb-0">$577545</h5>
                  </div>
                </div>
                <div class="d-flex py-3 border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-flag mr-3 icon-lg text-danger"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Flagged</small>
                    <h5 class="mr-2 mb-0">3497843</h5>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="purchases" role="tabpanel" aria-labelledby="purchases-tab">
              <div class="d-flex flex-wrap justify-content-xl-between">
                <div class="d-none d-xl-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-calendar-heart icon-lg mr-3 text-primary"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Start date</small>
                    <div class="dropdown">
                      <a class="btn btn-secondary dropdown-toggle p-0 bg-transparent border-0 text-dark shadow-none font-weight-medium" href="#" role="button" id="dropdownMenuLinkA" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <h5 class="mb-0 d-inline-block">26 Jul 2018</h5>
                      </a>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuLinkA">
                        <a class="dropdown-item" href="#">12 Aug 2018</a>
                        <a class="dropdown-item" href="#">22 Sep 2018</a>
                        <a class="dropdown-item" href="#">21 Oct 2018</a>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-currency-usd mr-3 icon-lg text-danger"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Revenue</small>
                    <h5 class="mr-2 mb-0">$577545</h5>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-eye mr-3 icon-lg text-success"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Total views</small>
                    <h5 class="mr-2 mb-0">9833550</h5>
                  </div>
                </div>
                <div class="d-flex border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-download mr-3 icon-lg text-warning"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Downloads</small>
                    <h5 class="mr-2 mb-0">2233783</h5>
                  </div>
                </div>
                <div class="d-flex py-3 border-md-right flex-grow-1 align-items-center justify-content-center p-3 item">
                  <i class="mdi mdi-flag mr-3 icon-lg text-danger"></i>
                  <div class="d-flex flex-column justify-content-around">
                    <small class="mb-1 text-muted">Flagged</small>
                    <h5 class="mr-2 mb-0">3497843</h5>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 stretch-card">
      <div class="card">
        <div class="card-body">
          <p class="card-title">Recent Orders</p>
          <div class="table-responsive">      

            <form>
            <table class="table table-hover" style="width:100%" id="recent-orders">
              <thead>
                <tr>
                    <!-- <th><span class="mx-2">Name</span></th>
                    <th><span class="mx-2">Price</span></th>
                    <th>Description</th>
                    <th><span class="mx-2">Ready</span></th>
                    <th><span class="mx-2">Tags</span></th> -->
                    <th>order_id</th>
                    <th>Customer Name</th>
                    <th>Quantity</th>
                    <th>product_id</th>
                    <th>Product Name</th>
                    <th>Order Time</th>
                    <th>Status</th>
                    <th>Price</th>
                </tr>
              </thead>
            </table>
            <button type="submit" class="btn btn-primary mr-2">Update</button>
            <a class="btn btn-warning mr-2" style="cursor: pointer" data-toggle="modal" data-target="#insertModal" id="insertButton">Insert</a>
            <a class="btn btn-success mr-2" style="color: white; cursor: pointer" data-toggle="modal" data-target="#completeModal" id="completeButton">Complete</a>
          </form>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Complete Modal -->
  <div class="modal fade" id="completeModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title w-100" id="exampleModalLabel">Order Check Out</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body mx-2">
          <div class="form">
                <form action="/admin/receipt" method="post" role="form">
                  <div class="form-group"  >
                    <label for="orderID">Order ID</label>
                    <input type="text" id="orderID" name="orderID">
                  </div>
                  <div class="text-center row">
                    <button class="form-control btn-danger col" title="Cancel Update" type="submit">Cancel</button>
                    <button class="form-control btn-success col" title="Send Update" type="submit">Completed</button>
                  </div>
                </form>
              </div>
        </div>
      </div>
    </div>
  </div>
  <!-- Insert Modal -->
  <div class="modal fade" id="insertModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title w-100">Insert New Order</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close" >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body mx-2">
          <div class="form">
                <form action="/admin/order" method="post" role="form">
                  <div class="form-group">
                    <label for="customerID">Customer ID</label>
                    <input type="text" class="form-control" placeholder="Enter Customer ID" name="customerID" required>
                  </div>
                  <div class="form-group">
                    <label for="menuID">Menu ID</label>
                    <input type="text" class="form-control" placeholder="Enter Menu ID" name="menuID" required>
                  </div>
                  <div class="form-group">
                    <label for="orderQuantity">Order Quantity</label>
                    <input type="number" class="form-control" placeholder="Enter Order Quantity" name="orderQuantity" required>
                  </div>
                  <div class="text-center row">
                    <button class="form-control btn-danger col" title="Cancel Update" type="button"  data-dismiss="modal" aria-label="Close" >Cancel</button>
                    <button class="form-control btn-success col" title="Send Update" type="submit">Insert</button>
                  </div>
                </form>
              </div>
        </div>
      </div>
    </div>
  </div>
</div>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/v/bs4/jq-3.3.1/dt-1.10.18/datatables.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/select/1.3.1/css/select.dataTables.min.css"
    />
    <script  
    type="text/javascript" 
    src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/moment-timezone/0.5.16/moment-timezone-with-data.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://cdn.datatables.net/v/bs4/jq-3.3.1/dt-1.10.18/datatables.min.js"
    ></script>
    <script  
    type="text/javascript" 
    src="https://cdn.datatables.net/select/1.3.1/js/dataTables.select.min.js"
    ></script>
    
    <!--datatables script-->
    <script>
        let recent_orders = $('#recent-orders').DataTable({
          scrollY: 300,
          processing: true,
          serverSide: true,
          ajax: "/admin/api/orders",
          "createdRow": function( row, data, dataIndex ) {
            for(var a = 0; a <= dataIndex ; a++){
              $(row).attr('id', 'menu'+ a);
              $(row).attr('data-toggle', 'modal');
              $(row).attr('data-id', a);
              $(row).attr('data-target', '#orderModal');
            }
          },
          columnDefs: [
            {
              targets: 5,
              render: function ( data, type, full, meta ) {
                let timezoned = moment(data).tz('Asia/Taipei').format('YYYY-MM-DD hh:mm:ss');
                
                let now = moment();
                let ms = moment(now).diff(moment(data));
                let d = moment.duration(ms);
                let s = Math.floor(d.asHours()) + moment.utc(ms).format(":mm:ss");

                if(d.hours() > 0){
                  return (d.hours() + " hours ago");
                }
                else if(d.minutes() > 0){
                  return (d.minutes() + " minutes ago");
                }
                else{
                  return (d.seconds() + " seconds ago");
                }
              }
            },
            {
                "targets": [ 0 , 3 ,7],
                "visible": false,
                "searchable": false
            },
            {
              targets: 6,
              render: function ( data, type, full, meta ) {
                if (data == 1){
                 return 'V';
               }else{
                return 'X';
               }
              }
            }
          ],
          "language": {
            "lengthMenu": 'Display <select class="form-control">'+
            '<option value="10">10</option>'+
            '<option value="20">20</option>'+
            '<option value="30">30</option>'+
            '<option value="40">40</option>'+
            '<option value="50">50</option>'+
            '</select> records'
          }
        });

        setInterval( function() {
            recent_orders.ajax.reload();
          }, 5000 );

        $("#insertButton").on("click", function(){
              
        })



         $('#recent-orders tbody').on( 'click', 'tr', function () {
              $(this).toggleClass('selected');
         });
          $("#completeButton").on("click", function(){
              let sel_num = recent_orders.rows('.selected').data().length;
              let order_id_array = [];

              for(let a = 0; a < sel_num; a++){
              console.log(recent_orders.rows('.selected').data()[a])
              order_id_array.push(recent_orders.rows('.selected').data()[a][0])
              }

              console.log(order_id_array)
              $('#orderID').attr('value',order_id_array);
          })



    </script>